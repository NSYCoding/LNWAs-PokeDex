// Data-mappen voor stat-namen en vertalingen
export const statMapping = {
    'attack': 'atk',
    'defense': 'def',
    'special-attack': 'spAtk',
    'special-defense': 'spDef',
    'speed': 'speed',
    'hp': 'hp'
};

export const translations = {
    nl: {
        language: "Taal",
        search: "Zoek Pokémon",
        random: "Willekeurige Pokémon",
        pokemon1: "Pokémon 1",
        pokemon2: "Pokémon 2",
        runTest: "Voer testwedstrijd uit",
        clear: "Wissen",
        winner: "Geschatte winnaar is:",
        tie: "Het is een gelijkspel! Kop of munt?",
        flip: "Gooi een munt op",
        finishedResults: "Afgewerkte resultaten",
        recommendation: "Aanbeveling/Uitleg",
        typeMatchups: "Type Match-Ups",
        saveMatchup: "Match-up opslaan",
        showSaved: "Opgeslagen match-ups tonen",
        savedHeader: "Opgeslagen Match-Ups",
        addItem: "Item toevoegen",
        selectedItem: "Geselecteerd item",
        addNature: "Voeg natuur toe",
        selectedNature: "Natuur toevoegen",
        emptySavedList: "Geen opgeslagen match-ups gevonden.",
        savedEntry: "Opgeslagen match-up: "
    },
    en: {
        language: "Language",
        search: "Search Pokémon",
        random: "Random Pokémon",
        pokemon1: "Pokémon 1",
        pokemon2: "Pokémon 2",
        runTest: "Run test contest",
        clear: "Clear",
        winner: "Estimated winner is:",
        tie: "It's a tie! Flip a coin?",
        flip: "Flip a coin",
        finishedResults: "Finished Results",
        recommendation: "Recommendation/Explanation",
        typeMatchups: "Type Match-Ups",
        saveMatchup: "Save Match-Up",
        showSaved: "Show saved match-ups",
        savedHeader: "Saved Match-Ups",
        addItem: "Add item",
        selectedItem: "Selected item",
        addNature: "Add nature",
        selectedNature: "Selected nature",
        emptySavedList: "No saved match-ups found.",
        savedEntry: "Saved match-up: "
    },
    de: {
        language: "Sprache",
        search: "Pokémon suchen",
        random: "Zufälliges Pokémon",
        pokemon1: "Pokémon 1",
        pokemon2: "Pokémon 2",
        runTest: "Testkampf starten",
        clear: "Löschen",
        winner: "Geschätzter Gewinner ist:",
        tie: "Unentschieden! Münze werfen?",
        flip: "Münze werfen",
        finishedResults: "Endergebnisse",
        recommendation: "Empfehlung/Erklärung",
        typeMatchups: "Typen-Vergleiche",
        saveMatchup: "Match-Up speichern",
        showSaved: "Gespeicherte Match-Ups anzeigen",
        savedHeader: "Gespeicherte Match-Ups",
        addItem: "Gegenstand hinzufügen",
        selectedItem: "Ausgewählter Gegenstand",
        addNature: "Natur hinzufügen",
        selectedNature: "Ausgewählte Natur",
        emptySavedList: "Keine gespeicherten Match-Ups gefunden.",
        savedEntry: "Gespeichertes Match-Up: "
    },
    ja: {
        language: "言語",
        search: "ポケモンを検索",
        random: "ランダムポケモン",
        pokemon1: "ポケモン 1",
        pokemon2: "ポケモン 2",
        runTest: "テストバトルを実行",
        clear: "クリア",
        winner: "予想される勝者:",
        tie: "引き分け！コインを投げる？",
        flip: "コインを投げる",
        finishedResults: "最終結果",
        recommendation: "おすすめ/説明",
        typeMatchups: "タイプ相性",
        saveMatchup: "対戦を保存",
        showSaved: "保存された対戦を表示",
        savedHeader: "保存された対戦",
        addItem: "アイテムを追加",
        selectedItem: "選択されたアイテム",
        addNature: "自然を追加",
        selectedNature: "選択した自然",
        emptySavedList: "保存された対戦は見つかりません。",
        savedEntry: "保存された対戦: "
    },
    ar: {
        language: "اللغة",
        search: "ابحث عن بوكيمون",
        random: "بوكيمون عشوائي",
        pokemon1: "بوكيمون 1",
        pokemon2: "بوكيمون 2",
        runTest: "تشغيل معركة تجريبية",
        clear: "مسح",
        winner: "الفائز المتوقع هو:",
        tie: "تعادل! هل نرمي عملة؟",
        flip: "ارمِ عملة",
        finishedResults: "النتائج النهائية",
        recommendation: "توصية/شرح",
        typeMatchups: "مواجهات الأنواع",
        saveMatchup: "حفظ المواجهة",
        showSaved: "عرض المواجهات المحفوظة",
        savedHeader: "المواجهات المحفوظة",
        addItem: "إضافة عنصر",
        selectedItem: "العنصر المحدد",
        addNature: "أضف الطبيعة",
        selectedNature: "الطبيعة المختارة",
        emptySavedList: "لم يتم العثور على مواجهات محفوظة.",
        savedEntry: "المواجهة المحفوظة: "
    },
    tr: {
        language: "Dil",
        search: "Pokémon Ara",
        random: "Rastgele Pokémon",
        pokemon1: "Pokémon 1",
        pokemon2: "Pokémon 2",
        runTest: "Test savaşı başlat",
        clear: "Temizle",
        winner: "Tahmini kazanan:",
        tie: "Berabere! Yazı tura at?",
        flip: "Yazı tura at",
        finishedResults: "Sonuçlar",
        recommendation: "Öneri/Açıklama",
        typeMatchups: "Tür Eşleşmeleri",
        saveMatchup: "Eşleşmeyi kaydet",
        showSaved: "Kayıtlı eşleşmeleri göster",
        savedHeader: "Kayıtlı Eşleşmeler",
        addItem: "Öğe ekle",
        selectedItem: "Seçilen öğe",
        addNature: "Doğa ekle",
        selectedNature: "Seçilen doğa",
        emptySavedList: "Kayıtlı eşleşme bulunamadı.",
        savedEntry: "Kayıtlı eşleşme: "
    },
    es: {
        language: "Idioma",
        search: "Buscar Pokémon",
        random: "Pokémon aleatorio",
        pokemon1: "Pokémon 1",
        pokemon2: "Pokémon 2",
        runTest: "Ejecutar batalla de prueba",
        clear: "Borrar",
        winner: "El ganador estimado es:",
        tie: "¡Es un empate! ¿Lanzar una moneda?",
        flip: "Lanzar moneda",
        finishedResults: "Resultados finales",
        recommendation: "Recomendación/Explicación",
        typeMatchups: "Enfrentamientos de tipos",
        saveMatchup: "Guardar enfrentamiento",
        showSaved: "Mostrar enfrentamientos guardados",
        savedHeader: "Enfrentamientos guardados",
        addItem: "Agregar objeto",
        selectedItem: "Objeto seleccionado",
        addNature: "Agregar naturaleza",
        selectedNature: "Naturaleza seleccionada",
        emptySavedList: "No se encontraron enfrentamientos guardados.",
        savedEntry: "Enfrentamiento guardado: "
    },
    pt: {
        language: "Idioma",
        search: "Procurar Pokémon",
        random: "Pokémon aleatório",
        pokemon1: "Pokémon 1",
        pokemon2: "Pokémon 2",
        runTest: "Executar batalha de teste",
        clear: "Limpar",
        winner: "O vencedor estimado é:",
        tie: "É um empate! Jogar uma moeda?",
        flip: "Jogar moeda",
        finishedResults: "Resultados finais",
        recommendation: "Recomendação/Explicação",
        typeMatchups: "Combinações de tipos",
        saveMatchup: "Salvar confronto",
        showSaved: "Mostrar confrontos salvos",
        savedHeader: "Confrontos Salvos",
        addItem: "Adicionar item",
        selectedItem: "Item selecionado",
        addNature: "Adicionar natureza",
        selectedNature: "Natureza selecionada",
        emptySavedList: "Nenhum confronto salvo encontrado.",
        savedEntry: "Confronto salvo: "
    }
};

// Arrays voor natures en items
export let natures = [];
export let items = [];

// Functie voor het ophalen van Pokémon-data (via naam of willekeurig)
export async function fetchPokemon(name = null) {
    let url;
    if (name) {
        url = `https://pokeapi.co/api/v2/pokemon/${name}`;
    } else {
        const randomId = Math.floor(Math.random() * 898) + 1;
        url = `https://pokeapi.co/api/v2/pokemon/${randomId}`;
    }

    const res = await fetch(url);
    if (!res.ok) throw new Error("Pokémon not found");
    return res.json();
}

// Functie voor het ophalen van Natures
export async function fetchNatures() {
    try {
        const res = await fetch('https://pokeapi.co/api/v2/nature?limit=100');
        const data = await res.json();
        const natureDetails = await Promise.all(data.results.map(n =>
            fetch(n.url).then(r => r.json())
        ));
        natures = natureDetails.map(n => ({
            id: n.name,
            name: n.name,
            increasedStat: n.increased_stat ? statMapping[n.increased_stat.name] : null,
            decreasedStat: n.decreased_stat ? statMapping[n.decreased_stat.name] : null
        }));
    } catch (error) {
        console.error("Failed to fetch natures:", error);
    }
}

// Functie voor het ophalen van Type-data
export async function fetchTypeData() {
    try {
        const res = await fetch("https://pokeapi.co/api/v2/type");
        const data = await res.json();
        const typeDetails = await Promise.all(data.results.map(type =>
            fetch(type.url).then(res => res.json())
        ));
        return typeDetails;
    } catch (error) {
        console.error("Failed to fetch type data:", error);
        return [];
    }
}

// Functie voor het initiëren van items
export function initializeItems() {
    const itemEffectsMapping = {
        'choice-scarf': { speedMul: 1.25 },
        'quick-claw': { quickClaw: true },
        'focus-sash': { focusSash: true },
        'life-orb': { atkMul: 1.5, spAtkMul: 1.2, recoil: 0.1 },
        'assault-vest': { spDefMul: 1.2 },
        'iron-ball': { speedMul: 0.5 },
        'lagging-tail': { alwaysLast: true}, 
        'choice-band': { atkMul: 1.5 },
        'wise-glasses': { spAtkMul: 1.8 },
        'eviolite': { defMul: 2.0, spDefMul: 2.0 },
        'power-herb': { atkMul: 1.5, defMul: 1.5 },
        'toxic-orb': { spAtkMul: 1.5, spDefMul: 0.5 },
        'sticky-barb': { atkMul: 1.2, speedDebuffOpponent: 0.7 },
        'flame-orb': { burn: true}, 
        'mach-bike': { speedMul: 1.8 },
        'charcoal': { fireTypeBoost: 2.0 },
        'mystic-water': { waterTypeBoost: 2.0 },
        'miracle-seed': { grassTypeBoost: 2.0 },
        'never-melt-ice': { iceTypeBoost: 2.0 },
        'sharp-beak': { flyingTypeBoost: 2.0 },
        'magnet': { electricTypeBoost: 2.0 },
        'soft-sand': { groundTypeBoost: 2.0 },
        'black-belt': { fightingTypeBoost: 2.0 },
        'poison-barb': { poisonTypeBoost: 2.0 },
        'silver-powder': { bugTypeBoost: 2.0 },
        'hard-stone': { rockTypeBoost: 2.0 },
        'spell-tag': { ghostTypeBoost: 2.0 },
        'twisted-spoon': { psychicTypeBoost: 2.0 },
        'dragon-fang': { dragonTypeBoost: 2.0 },
        'black-glasses': { darkTypeBoost: 2.0 },
        'metal-coat': { steelTypeBoost: 2.0 },
        'silk-scarf': { normalTypeBoost: 2.0 },
        'pink-bow': { normalTypeBoost: 2.0 },
        'bright-powder': { evasionBoost: true}, 
        'scyther-wing': { flyingTypeBoost: 2.0 },
        'thick-club': { specialAttackBoost: 2.0 },
        'light-ball': { specialAttackBoost: 2.0 },
        'quick-powder': { speedBoost: 2.0 }
    };

    items = [{
        id: "none",
        name: "None",
        effects: {}
    }];

    for (const [key, effects] of Object.entries(itemEffectsMapping)) {
        const name = key.replace(/-/g, ' ').split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
        items.push({
            id: key,
            name: name,
            effects: effects
        });
    }
}

// Functie voor het berekenen van de effectieve stat-waarde
export function getEffectiveStat(baseValue, statName, nature = null, item = null) {
    let value = baseValue;

    // Pas Nature-effecten toe
    if (nature) {
        const mappedStatName = statMapping[statName];
        if (nature.increasedStat === mappedStatName) {
            value = Math.round(baseValue * 1.1);
        } else if (nature.decreasedStat === mappedStatName) {
            value = Math.round(baseValue * 0.9);
        }
    }

    // Pas Item-effecten toe (let op de `.` syntax)
    if (item && item.effects) {
        if (item.effects.speedMul && statName === 'speed') value *= item.effects.speedMul;
        if (item.effects.atkMul && statName === 'attack') value *= item.effects.atkMul;
        if (item.effects.spAtkMul && statName === 'special-attack') value *= item.effects.spAtkMul;
        if (item.effects.defMul && statName === 'defense') value *= item.effects.defMul;
        if (item.effects.spDefMul && statName === 'special-defense') value *= item.effects.spDefMul;
    }

    return value;
}